_='func fromEuler,r){o=PI/360;e*=o,r*=o,i*=o;n=sin(ea=cos(es=sin(il=cos(ih=sin(rc=cos(r);t[0n*l*c-a*s*ha*s*c+n*l*h^2a*l*h-n*s*c^3a*l*c+n*s*h,tnormalize_vector(t){e=t[0i=t[1r=t[2o=e*e+i*i+r*r;o>0&&(o=1/sqrt(o))^0]*=o]*=o^2]*=ocross){r0o1n2a=i[0s=i[1l=i[2];t[0o*l-n*sn*a-r*l^2r*s-o*a}getOpposedV=,r)=>{for(o=0;o<t.length;o+=3){if(t[o=e&&t[o+1=i&&t[o+2]!=r)t[o+2];if(t[o=i&&t[o+1=e&&t[o+2]!=r)t[o+2];if(t[o=e&&t[o+2=i&&t[o+1]!=r)t[o+1];if(t[o=i&&t[o+2=e&&t[o+1]!=r)t[o+1];if(t[o+1=e&&t[o+2=i&&t[o]!=r)t[o];if(t[o+1=i&&t[o+2=e&&t[o]!=r)t[o]}return-1},weightOddV=,r,o,n,a,s)=>{l=getOpposedV(t,r,o,n);-1!=l?(x=(3*i[3*r]+3*i[3*o]+i[3*n]+i[3*l])/8,y=(3*i[3*r+1]+3*i[3*o+1]+i[3*n+1]+i[3*l+1])/8,z=(3*i[3*r+2]+3*i[3*o+2]+i[3*n+2]+i[3*l+2])/8):(x=(i[3*r]+i[3*o])/2,y=(i[3*r+1]+i[3*o+1])/2,z=(i[3*r+2]+i[3*o+2])/2e[3*ax,e[3*a+1y,e[3*a+2z},weightEvenV=,r)=>{o=i[3*rn=i[3*r+1a=i[3*r+2s=0,l=0,h=0,c=[f=0;for(e=0;e<t.length;e+=3){o=[t[e]^e+1]^e+2]];for(t=0;t<o.length;t++){e=o[tn=o[(t+1)%3a=o[(t+2)%3];e==r&&(c[n]||(c[n1,s+=i[3*nl+=i[3*n+1h+=i[3*n+2f++c[a]||(c[a1,s+=i[3*al+=i[3*a+1h+=i[3*a+2f++))}}g=1;if(f>3){t=.375+.25*cos(2*PI/f);g=(.625-t*t)/f}else g=.1875;e[3*rs*g+o*(1-f*ge[3*r+1l*g+n*(1-f*ge[3*r+2h*g+a*(1-f*g)},findHalfV=,r)=>{if(e<t){i=t;t=e,e=i}o=1e5*t+e;n=1;i[o]||(i[or,n=0[n,i[o]]},subdivide=,r,o,n,a)=>{for(s=0;s<a;s++){l=r.length/3;duplicated=[];for(a=0;a<e.length;a+=3){saha+1ca+2];let[f,gfindHalfV(s,h,duplicated,l);f||(l++,weightOddV(e,i,r,s,h,c,g));let[u,dfindHalfV(s,c,duplicated,l);u||(l++,weightOddV(e,i,r,s,c,h,d));let[p,mfindHalfV(h,c,duplicated,l);p||(l++,weightOddV(e,i,r,h,c,s,m)weightEvenV(e,i,r,sweightEvenV(e,i,r,hweightEvenV(e,i,r,ct.push(st.push(gt.push(dt.push(dt.push(ct.push(mt.push(gt.push(ht.push(mt.push(gt.push(dt.push(mo&&(o.push(n[a/3]o.push(n[a/3]o.push(n[a/3]o.push(n[a/3]))}s!=a-1&&(e=[...tr=[...in=[...o])}},generateFaceNormals=(t,e)=>{i=[];for(r=0;r<t.length;r+=3){o=t[rn=t[r+1a=t[r+2s=[l=[h=[];for(t=0;t<3;t++)s[te[3*o+t]-e[3*n+tl[te[3*a+t]-e[3*n+t];cross(h,s,lnormalize_vector(hi[rh[0i[r+1h[1i[r+2h[2]}i};EPSILON=1e-6;func create(){t=new Float32Array(16);t[01^510151,tcopy(t,e){i=e.length;for(;i--;)t[ie[i]transformMat4){r0o1n2a3];t[0i[0]*r+i[4]*o+i[8]*n+i[12]*ai[1]*r+i[5]*o+i[9]*n+i[13]*a^2i[2]*r+i[6]*o+i[10]*n+i[14]*a^3i[3]*r+i[7]*o+i[11]*n+i[15]*a,tcross){r0o1n2a=i[0s=i[1l=i[2];t[0o*l-n*sn*a-r*l^2r*s-o*a,tnormalize(t,e){i0r1o2n=i*i+r*r+o*o;n>0&&(n=1/sqrt(n))^0i*nr*n^2o*n,tfromValues,r,o,n,a,s,l,h,c,f,g,u,d,p){m=new Float32Array(16);m[0t,m[1e,m[2i,m[3r,m[4o,m[5n,m[6a,m[7s,m[8l,m[9h,m[10c,m[11f,m[12g,m[13u,m[14d,m[15p,mset,r,o,n,a,s,l,h,c,f,g,u,d,p,m){t[0ei^2r^3o^4n^5a^6s^7l^8h^9c0f1g2u3d4p5m,tidentity(t){t[0123451^67891011121314151,ttranspose(t,e){if(t===e){i1r2o3n6a7s11];t[1e[4]^2e[8]^3e[12]^4i^6e[9]^7e[13]^8r^9n1e[14]2o3a4s}else t[0e[0]e[4]^2e[8]^3e[12]^4e[1]^5e[5]^6e[9]^7e[13]^8e[2]^9e[6]0e[10]1e[14]2e[3]3e[7]4e[11]5e[15];tinver,y=x*E-M*B+_*T+A*w-b*P+L*R;y?(y=1/y^0(s*E-l*B+h*T)*y(o*B-r*E-n*T)*y^2(p*L-m*b+v*A)*y^3(g*b-f*L-u*A)*y^4(l*w-a*E-h*P)*y^5(i*E-o*w+n*P)*y^6(m*_-d*L-v*M)*y^7(c*L-g*_+u*M)*y^8(a*B-s*w+h*R)*y^9(r*w-i*B-n*R)*y0(d*b-p*_+v*x)*y1(f*_-c*b-u*x)*y2(s*P-a*T-l*R)*y3(i*T-r*P+o*R)*y4(p*M-d*A-m*x)*y5(c*A-f*M+g*x)*y,t):nulladjoin;t[0s*E-l*B+h*To*B-r*E-n*T^2p*L-m*b+v*A^3g*b-f*L-u*A^4l*w-a*E-h*P^5i*E-o*w+n*P^6m*_-d*L-v*M^7c*L-g*_+u*M^8a*B-s*w+h*R^9r*w-i*B-n*R0d*b-p*_+v*x1f*_-c*b-u*x2s*P-a*T-l*R3i*T-r*P+o*R4p*M-d*A-m*x5c*A-f*M+g*x,tdeterminant(t){e=t[0i=t[1r=t[2o=t[3n=t[4a=t[5s=t[6l=t[7h=t[8c=t[9f=t[10g=t[11u=t[12d=t[13p=t[14m=e*a-i*n,v=e*s-r*n,x=i*s-r*a,M=h*d-c*u,_=h*p-f*u,A=c*p-f*d;l*(e*A-i*_+r*M)-o*(n*A-a*_+s*M)+t[15]*(h*x-c*v+f*m)-g*(u*x-d*v+p*m)multiply){r0o1n2a3s4l5h6c7f8g9u10d11p12m13v14x15M=i[0_=i[1A=i[2b=i[3];t[0M*r+_*s+A*f+b*pM*o+_*l+A*g+b*m^2M*n+_*h+A*u+b*v^3M*a+_*c+A*d+b*x,M=i[4_=i[5A=i[6b=i[7]^4M*r+_*s+A*f+b*p^5M*o+_*l+A*g+b*m^6M*n+_*h+A*u+b*v^7M*a+_*c+A*d+b*x,M=i[8_=i[9A=i[10b=i[11]^8M*r+_*s+A*f+b*p^9M*o+_*l+A*g+b*m0M*n+_*h+A*u+b*v1M*a+_*c+A*d+b*x,M=i[12_=i[13A=i[14b=i[15]2M*r+_*s+A*f+b*p3M*o+_*l+A*g+b*m4M*n+_*h+A*u+b*v5M*a+_*c+A*d+b*x,ttranslate){r,o,n,a,s,l,h,c,f,g,u,d,p=i[0m=i[1v=i[2];e===t?(t[12e[0]*p+e[4]*m+e[8]*v+e[12]3e[1]*p+e[5]*m+e[9]*v+e[13]4e[2]*p+e[6]*m+e[10]*v+e[14]5e[3]*p+e[7]*m+e[11]*v+e[15]):(r0o1n2a3s4l5h6c7f8g9u10d11]^0ro^2n^3a^4s^5l^6h^7c^8f^9g0u1d2r*p+s*m+f*v+e[12]3o*p+l*m+g*v+e[13]4n*p+h*m+u*v+e[14]5a*p+c*m+d*v+e[15]tscale){r=i[0o=i[1n=i[2];t[0e[0]*re[1]*r^2e[2]*r^3e[3]*r^4e[4]*o^5e[5]*o^6e[6]*o^7e[7]*o^8e[8]*n^9e[9]*n0e[10]*n1e[11]*n2e[12]3e[13]4e[14]5e[15trotate,r){o,n,a,s,l,h,c,f,g,u,d,p,m,v,x,M,_,A,b,L,R,P,w,T,B=r[0E=r[1y=r[2C=hypot(B,E,y);C<EPSILON?null:(C=1/C,B*=C,E*=C,y*=C,o=sin(in=cos(ia=1-n,s0l1h2c3f4g5u6d7p8m9v10x11M=B*B*a+n,_=E*B*a+y*o,A=y*B*a-E*o,b=B*E*a-y*o,L=E*E*a+n,R=y*E*a+B*o,P=B*y*a+E*o,w=E*y*a-B*o,T=y*y*a+n^0s*M+f*_+p*Al*M+g*_+m*A^2h*M+u*_+v*A^3c*M+d*_+x*A^4s*b+f*L+p*R^5l*b+g*L+m*R^6h*b+u*L+v*R^7c*b+d*L+x*R^8s*P+f*w+p*T^9l*P+g*w+m*T0h*P+u*w+v*T1c*P+d*w+x*T,e!==t&&(t[12e[12]3e[13]4e[14]5e[15]t)rotateX){r=sin(io=cos(in4a5s6l7h8c9f10g11];e!==t&&(t[0e[0]e[1]^2e[2]^3e[3]2e[12]3e[13]4e[14]5e[15])^4n*o+h*r^5a*o+c*r^6s*o+f*r^7l*o+g*r^8h*o-n*r^9c*o-a*r0f*o-s*r1g*o-l*r,trotateY){r=sin(io=cos(in0a1s2l3h8c9f10g11];e!==t&&(t[4e[4]^5e[5]^6e[6]^7e[7]2e[12]3e[13]4e[14]5e[15])^0n*o-h*ra*o-c*r^2s*o-f*r^3l*o-g*r^8n*r+h*o^9a*r+c*o0s*r+f*o1l*r+g*o,trotateZ){r=sin(io=cos(in0a1s2l3h4c5f6g7];e!==t&&(t[8e[8]^9e[9]0e[10]1e[11]2e[12]3e[13]4e[14]5e[15])^0n*o+h*ra*o+c*r^2s*o+f*r^3l*o+g*r^4h*o-n*r^5c*o-a*r^6f*o-s*r^7g*o-l*r,tfromTransla(t,e){t[0123451^6789101112e[0]3e[1]4e[2]51,tfromScaling(t,e){t[0e[0]2345e[1]^678910e[2]1121314151,tfromRota){r,o,n,a=i[0s=i[1l=i[2h=hypot(a,s,l);h<EPSILON?null:(h=1/h,a*=h,s*=h,l*=h,r=sin(eo=cos(en=1-o^0a*a*n+os*a*n+l*r^2l*a*n-s*r^34a*s*n-l*r^5s*s*n+o^6l*s*n+a*r^78a*l*n+s*r^9s*l*n-a*r0l*l*n+o1121314151,t)fromXRota(t,e){i=sin(er=cos(e);t[012345r^6i^789-i0r1121314151,tfromYRota(t,e){i=sin(er=cos(e);t[0r2-i^3451^678i^910r1121314151,tfromZRota(t,e){i=sin(er=cos(e);t[0ri^234-i^5r^67891011121314151,tfromRotaTransla){r0o1n2a3s=r+r,l=o+o,h=n+n,c=r*s,f=r*l,g=r*h,u=o*l,d=o*h,p=n*h,m=a*s,v=a*l,x=a*h;t[01-(u+p)f+x^2g-v^34f-x^51-(c+p)^6d+m^78g+v^9d-m01-(c+u)112i[0]3i[1]4i[2]51,tfromQuat2(t,e){i=Float32Array(3r=-e[0o=-e[1n=-e[2a3s4l5h6c7f=r*r+o*o+n*n+a*a;f>0?(i[02*(s*a+c*r+l*n-h*o)/f,i[12*(l*a+c*o+h*r-s*n)/f,i[22*(h*a+c*n+s*o-l*r)/f):(i[02*(s*a+c*r+l*n-h*oi[12*(l*a+c*o+h*r-s*ni[22*(h*a+c*n+s*o-l*r)fromRotaTranslatgetTransla(t,e){t[0e[12]e[13]^2e[14tgetScaling(t,e){i0r1o2n4a5s6l8h9c10];t[0hypot(i,r,o)hypot(n,a,s)^2hypot(l,h,ctgetRota(t,e){i=new Float32Array(3);getScaling(i,e);r=1/i[0o=1/i[1n=1/i[2a0]*r,s1]*o,l2]*n,h4]*r,c5]*o,f6]*n,g8]*r,u9]*o,d10]*n,p=a+c+d,m=0;p>0?(m=2*sqrt(p+1)^3.25*m^0(f-u)/m(g-l)/m^2(s-h)/m):a>c&&a>d?(m=2*sqrt(1+a-c-d)^3(f-u)/m^0.25*m(s+h)/m^2(g+l)/m):c>d?(m=2*sqrt(1+c-a-d)^3(g-l)/m^0(s+h)/m.25*m^2(f+u)/m):(m=2*sqrt(1+d-a-c)^3(s-h)/m^0(g+l)/m(f+u)/m^2.25*mtdecompose,r){e[0r[12e[1r[13e[2r[14];o=r[0n=r[1a=r[2s=r[4l=r[5h=r[6c=r[8f=r[9g=r[10];i[0hypot(o,n,ai[1hypot(s,l,hi[2hypot(c,f,g);u=1/i[0d=1/i[1p=1/i[2m=o*u,v=n*d,x=a*p,M=s*u,_=l*d,A=h*p,b=c*u,L=f*d,R=g*p,P=m+_+R,w=0;P>0?(w=2*sqrt(P+1)^3.25*w^0(A-L)/w(b-x)/w^2(v-M)/w):m>_&&m>R?(w=2*sqrt(1+m-_-R)^3(A-L)/w^0.25*w(v+M)/w^2(b+x)/w):_>R?(w=2*sqrt(1+_-m-R)^3(b-x)/w^0(v+M)/w.25*w^2(A+L)/w):(w=2*sqrt(1+R-m-_)^3(v-M)/w^0(b+x)/w(A+L)/w^2.25*wtfromRotaTranslaScale,r){o0n1a2s3l=o+o,h=n+n,c=a+a,f=o*l,g=o*h,u=o*c,d=n*h,p=n*c,m=a*c,v=s*l,x=s*h,M=s*c,_=r[0A=r[1b=r[2];t[0(1-(d+m))*_(g+M)*_^2(u-x)*_^34(g-M)*A^5(1-(f+m))*A^6(p+v)*A^78(u+x)*b^9(p-v)*b0(1-(f+d))*b112i[0]3i[1]4i[2]51,tfromRotaTranslaScaleOrigin,r,o){n0a1s2l3h=n+n,c=a+a,f=s+s,g=n*h,u=n*c,d=n*f,p=a*c,m=a*f,v=s*f,x=l*h,M=l*c,_=l*f,A=r[0b=r[1L=r[2R=o[0P=o[1w=o[2T=(1-(p+v))*A,B=(u+_)*A,E=(d-M)*A,y=(u-_)*b,C=(1-(g+v))*b,F=(m+x)*b,S=(d+M)*L,I=(m-x)*L,D=(1-(g+p))*L;t[0TB^2E^34y^5C^6F^78S^9I0D112i[0]+R-(T*R+y*P+S*w)3i[1]+P-(B*R+C*P+I*w)4i[2]+w-(E*R+F*P+D*w)51,tfromQuat(t,e){i0r1o2n3a=i+i,s=r+r,l=o+o,h=i*a,c=r*a,f=r*s,g=o*a,u=o*s,d=o*l,p=n*a,m=n*s,v=n*l;t[01-f-dc+v^2g-m^34c-v^51-h-d^6u+p^78g+m^9u-p01-h-f1121314151,tfrustum,r,o,n,a){s=1/(i-el=1/(o-rh=1/(n-a);t[02*n*s23452*n*l^678(i+e)*s^9(o+r)*l0(a+n)*h1-121314a*n*2*h50,tperspectiveNO,r,o){n=1/tan(e/2);if(t[0n/i2345n^678911-1213150,null!=o&&o!==1/0){e=1/(r-o);t[10(o+r)*e42*o*r*e}else t[10-14-2*r;t}perspective=perspectiveNO;func perspectiveZO,r,o){n=1/tan(e/2);if(t[0n/i2345n^678911-1213150,null!=o&&o!==1/0){e=1/(r-o);t[10o*e4o*r*e}else t[10-14-r;tperspectiveFromFieldOfView,r){o=tan(e.upDegrees*PI/180n=tan(e.downDegrees*PI/180a=tan(e.leftDegrees*PI/180s=tan(e.rightDegrees*PI/180l=2/(a+sh=2/(o+n);t[0l2345h^678-(a-s)*l*.5^9(o-n)*h*.50r/(i-r)1-121314r*i/(i-r)50,torthoNO,r,o,n,a){s=1/(e-il=1/(r-oh=1/(n-a);t[0-2*s2345-2*l^6789102*h112(e+i)*s3(o+r)*l4(a+n)*h51,t}ortho=orthoNO;func orthoZO,r,o,n,a){s=1/(e-il=1/(r-oh=1/(n-a);t[0-2*s2345-2*l^678910h112(e+i)*s3(o+r)*l4n*h51,tlookAtPYR,r){o=sin(rn=cos(ra=sin(is=cos(il=sin(eh=cos(e);t[0n*sn*a*l-o*h^2n*a*h+o*l^34o*s^5o*a*l+n*h^6o*a*h-n*l^78-a^9s*l0s*h1121314151lookAt,r){o,n,a,s,l,h,c,f,g,u,d0p1m2v=r[0x=r[1M=r[2_=i[0A=i[1b=i[2];abs(d-_)<EPSILON&&abs(p-A)<EPSILON&&abs(m-b)<EPSILON?identity(t):(c=d-_,f=p-A,g=m-b,u=1/hypot(c,f,gc*=u,f*=u,g*=u,o=x*g-M*f,n=M*c-v*g,a=v*f-x*c,u=hypot(o,n,au?(u=1/u,o*=u,n*=u,a*=u):(o=0,n=0,a=0s=f*a-g*n,l=g*o-c*a,h=c*n-f*o,u=hypot(s,l,hu?(u=1/u,s*=u,l*=u,h*=u):(s=0,l=0,h=0)^0os^2c^34n^5l^6f^78a^9h0g112-(o*d+n*p+a*m)3-(s*d+l*p+h*m)4-(c*d+f*p+g*m)51,t)targetTo,r){o0n1a2s=r[0l=r[1h=r[2c=o-i[0f=n-i[1g=a-i[2u=c*c+f*f+g*g;u>0&&(u=1/sqrt(uc*=u,f*=u,g*=u);d=l*g-h*f,p=h*c-s*g,m=s*f-l*c;u=d*d+p*p+m*m,u>0&&(u=1/sqrt(ud*=u,p*=u,m*=u)^0dp^2m^34f*m-g*p^5g*d-c*m^6c*p-f*d^78c^9f0g112o3n4a51,tstr(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}FRAGMENT_SHADER=0,VERTEX_SHADER=1;buildShader=(t,e)=>{i=createShader(0==t?FRAGMENT_SHADER:VERTEX_SHADER);shaderSource(i,ecompileShader(igetShaderParameter(i,COMPILE_STATUS)?i:(console.log("An error occurred compiling the "+(0==t?"fragment":"v")+" shader: "+getShaderInfoLog(i)+" :"+enull)},buildShaderProgram=(t,e)=>{var i=createProgram();if(attachShader(i,buildShader(1,t)attachShader(i,buildShader(0,e)linkProgram(i!getProgramParameter(i,LINK_STATUS))throw"Could not link the shader program!";i},drawObject=,r)=>{useProgram(i.shaderProgrambind(ARRAY_BUFFER,i.vIdenableVAttribArray(i..vPosivAttribPointer(i..vPosi,3,FLOAT,!1,0,0bind(ARRAY_BUFFER,i.colorIdenableVAttribArray(i..vColorvAttribPointer(i..vColor,4,FLOAT,!1,0,0uniform4fv(i.us.projec,!1,tuniform4fv(i.us.camera,!1,euniform4fv(i.us.modelView,!1,i.getModelView()i.preRender(rbind(ELEMENT_ARRAY_BUFFER,i.indexIddrawElements(TRIANGLES,i.index().length,UNSIGNED_SHORT,0i.postRender(rdisableVAttribArray(i..vPosidisableVAttribArray(i..vColor)};class RenderObject{constructor(t){$={},$us={},$id=t,$ttl=1,$_posi=[0,0,0$posi=[0,0,0]}setPosi=t=>{$posi[0$_posi[0t[0$posi[1$_posi[1t[1$posi[2$_posi[2t[2]};init=t=>{J~ex(STATIC_DRAW)};getModelView=t=>{e=create();translate(e,e,$posie};color=t=>[];index=t=>[];v=t=>[];logicTick=)=>{};preRender=t=>{};postRender=t=>{};logicStep=t=>{$cubeRota=$_cubeRota+$rotaSpeed*t};vShader=t=>"@  attribute vec4 aVPosi;@  attribute vec4 aVColor;@  uniform mat4 uModelView;@  uniform mat4 uProjec;@  uniform mat4 uCamera;@  varying lowp vec4 vColor;\\n@  void main(void) {@    gl_Posi = uProjec * uCamera * uModelView * aVPosi;@    vColor = aVColor;@  }\\n    ";fragmentShader=t=>"@varying lowp vec4 vColor;@@void main(void) {@  gl_FragColor = vColor;@}\\n    "}class Sphere extends RenderObject{constructor,r,o,n=!1,a=[0,0,0]){super(t$={},$us={},$id=t,$ttl=1,$slices=e,$stacks=i,$scale=r,$color=o,$alphaCloud=n,$displacement=a}init=t=>{e=[i=[r=[];e.push(0e.push(1e.push(0);for(t=0;t<$stacks-1;t++){i=PI*(t+1)/$stacks;for(t=0;t<$slices;t++){r=2*PI*t/$slices;e.push(sin(i)*cos(r)*$scalee.push(cos(i)*$scalee.push(sin(i)*sin(r)*$scale)}}e.push(0e.push(-1e.push(0);for(t=0;t<$slices;t++){o=t+1,n=(t+1)%$slices;i.push(0,o,no=t+$slices*($stacks-2)+1,n=(t+1)%$slices+$slices*($stacks-2i.push((e.length-3)/3,o,n);for(t=0;t<3;t++)r.push(...$color)}for(t=0;t<$stacks-2;t++){e=t*$slices+1,o=(t+1)*$slices+1;for(t=0;t<$slices;t++){i.push(e+ti.push(e+(t+1)%$slicesi.push(o+(t+1)%$slicesi.push(o+(t+1)%$slicesi.push(o+ti.push(e+t);for(t=0;t<6;t++)r.push(...$color)}}$v=new Float32Array(e$indices=new Uint16Array(i$colors=new Float32Array(r$posi=[0,0,0Jus.col=getU($shaderProgram,"col"$us.alphaCloud=getU($shaderProgram,"alphaCloud"$us.t=getU($shaderProgram,"t"$us.displacement=getU($shaderProgram,"displacement"$vId=create(bind(ARRAY_BUFFER,$vIdbufferData(ARRAY_BUFFER,$v,	s,STATIC_DRAWvAttribPointer($.vColor,4,FLOAT,!1,0,0$ices,STATIC_DRAW)};getModelView=t=>{e=create();translate(e,e,$posie};color=t=>$colors;index=t=>$indices;v=t=>$v;logicTick=t=>{};logicStep=t=>{};preRender=t=>{uniform4fv($us.col,$coloruniform1i($us.alphaCloud,$alphaClouduniform1f($us.t,1e-5*tuniform3fv($us.displacement,$displacement$alphaCloud&&disable(CULL_FACE)};postRender=t=>{enable(CULL_FACE)};vShader=t=>"@attribute vec4 aVPosi;@attribute vec4 aVColor;@uniform mat4 uModelView;@uniform mat4 uProjec;@uniform mat4 uCamera;@varying lowp vec4 vColor}\\n  ";fragmentShader=t=>"\\n    precision mediump float;\\n    varying lowp vec4 vPos;\\n\\n    uniform vec4 col;\\n    uniform vec3 displacement;\\n    uniform int alphaCloud;\\n    uniform float t;\\n\\n    float occ = 1.0;\\n\\n    float hash(vec3 p)  // replace this by something better\\n    {@  p  = fract( p*0.3183099+.1 );@  p *= 17.0;@  fract( p.x*p.y*p.z*(p.x+p.y+p.z) );\\n    }\\n    \\n    float noise( in vec3 x )\\n    {@  vec3 i = floor(x);@  vec3 f = fract(x);@  f = f*f*(3.0-2.0*f);@@  mix(mix(mix( hash(i+vec3(0,0,0) @                      hash(i+vec3(1,0,0)f.x@                 mix( hash(i+vec3(0,1,0) @                      hash(i+vec3(1,1,0)f.xf.y@             mix(mix( hash(i+vec3(0,0,1) @                      hash(i+vec3(1,0,1)f.x@                 mix( hash(i+vec3(0,1,1) @                      hash(i+vec3(1,1,1)f.xf.yf.z);\\n    }\\n    \\n    void main(void) {@vec3 pos = vPos.xyz * 0.01 + t * displacement;@vec4 shade = vec4(0.9);@float f = 0.0;@@vec3 q = 8.0*pos;@f  = 0.5000*noise( q ); q = q*2.01;@f += 0.2500*noise( q ); q = q*2.02;@f += 0.1250*noise( q ); q = q*2.03;@f += 0.0625*noise( q ); q = q*2.01;@@f *= occ;\\n@if (alphaCloud == 1) {@  if (f > 0.7) f = 1.0;@  else if (f > 0.5) f = 0.6;@  else f = 0.0;\\n@  gl_FragColor = vec4(col.xyz, f);@} else {@  f = sqrt(f*1.5);@  \\n@  if (f > 0.67) f = 1.0;@  else if (f > 0.33) f = 0.5;@  else f = 0.0;@  @  gl_FragColor = vec4(f * col.xyz, 1.0);@}\\n    }\\n    "}LASER_SPEED=5,LASER_TTL=250;class Laser extends RenderObject{constructor(t){super(t$={},$us={},$id=t,$direc=[0,0,1,0$ttl=250,$rota_quat=[0,0,0,0$direc=create()}init=t=>{$v=new Float32Array([-.1,-.1,2,.1,-.1,2,.1,.1,2,-.1,.1,2,-.1,-.1,-2,-.1,.1,-2,.1,.1,-2,.1,-.1,-2,-.1,.1,-2,-.1,.1,2,.1,.1,2,.1,.1,-2,-.1,-.1,-2,.1,-.1,-2,.1,-.1,2,-.1,-.1,2,.1,-.1,-2,.1,.1,-2,.1,.1,2,.1,-.1,2,-.1,-.1,-2,-.1,-.1,2,-.1,.1,2,-.1,.1,-2]);e=[[1,0,0,1[1,0,0,1[1,0,0,1[1,0,0,.5[1,0,0,.5[1,0,0,.5]];i=[];for(t=0;t<e.length;++t){rt];i=i.concat(r,r,r,r)}$colors=new Float32Array(i$indices=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]$posi=[0,0,0J~ex(STATIC_DRAW)};getModelView=t=>{e=create();fromRotaTransla(e,$rota_quat,$posie};color=t=>$colors;index=t=>$indices;v=t=>$v;logicTick=t=>{$_posi[0]+=5*$direc[0$_posi[1]+=5*$direc[1$_posi[2]+=5*$direc[2$ttl--};logicStep=t=>{$posi[0$_posi[0]+t*(5*$direc[0]$posi[1$_posi[1]+t*(5*$direc[1]$posi[2$_posi[2]+t*(5*$direc[2])}}TTL_FIRE=1e3;class Ship extends RenderObject{constructor(t){super(t$_cubeRota=PI,$cubeRota=PI,$rotaSpeed=.01*random()+.005,$fireTTL=800+200*random()}init=t=>{$v=new Float32Array(ship_v$colors=new Float32Array(ship_v_colors$indices=new Uint16Array(ship_indices$normals=new Float32Array(ship_normals$posi=[900*(random()-.5900*(random()-.51500*(random()-.5)Jr"$.normal=getAttribLoca($shaderProgram,"aNormalBuffe~normalId=create(bind(ARRAY_BUFFER,$normalIdbufferData(ARRAY_BUFFER,$normal(STATIC_DRAWvAttribPointer($.normal,3,FLOAT,!0,0,0$ex(STATIC_DRAW)};preRender=t=>{disable(CULL_FACEbind(ARRAY_BUFFER,$normalIdenableVAttribArray($.normalvAttribPointer($.normal,3,FLOAT,!0,0,0)};postRender=t=>{enable(CULL_FACEdisableVAttribArray($.normal)};getModelView=t=>{e=create();translate(e,e,$posirotate(e,e,PI,[0,0,1]rotate(e,e,-.1,[1,0,0]rotate(e,e,.7*$cubeRota,[0,1,0]e};logicTick=)=>{if($_cubeRota+=$rotaSpeed,--$fireTTL<=0){t=new Laser(getID());t.init(t.direc=create(t.direc=[e.x-$posi[0e.y-$posi[1e.z-$posi[2]normalize(t.direc,t.direct.setPosi([$posi[0$posi[1$posi[2]]i[t.idt,$fireTTL=1e3}};logicStep=t=>{$cubeRota=$_cubeRota+$rotaSpeed*t};color=t=>$colors;index=t=>$indices;v=t=>$v;normal=t=>$normals;vShader=t=>"@attribute vec4 aVPosi;@attribute vec4 aVColor;@attribute vec3 aNormal;\\n@uniform mat4 uModelView;@uniform mat4 uProjec;@uniform mat4 uCamera;@varying lowp vec4 vColor;@varying lowp vec3 vNormal  vNormal = vec3(uModelView * vec4(aNormal, 0.0));@}\\n  ";fragmentShader=t=>"@precision mediump float;\\n@varying lowp vec4 vPos;@varying lowp vec4 vColor;@varying lowp vec3 vNormal;\\n@void main(void) {@  vec3 light = vec3(0.0, -1000.0, -1000.0);        @  vec3 dir = normalize(light - vPos.xyz);@  vec3 eye = normalize(-vPos.xyz);@  vec3 reflec = normalize(-reflect(light, vNormal));\\n@  float f = abs(dot(dir, vNormal));@  if (f > 0.67) f = 1.0;@  else if (f > 0.33) f = 0.8;@  else f = 0.6;\\n@  float specular = 128.0 * pow(abs(dot(reflec, eye) 512.0);@  if (specular > 0.05 && specular < 0.95) specular = -1.0;\\n@  gl_FragColor = vec4(vColor.xyz * f + specular, 1.0);@}\\n    "}segments=[new Path2D("M1,1 2,0 8,0 9,1 8,2 2,2z"new Path2D("M9,1 10,2 10,8 9,9 8,8 8,2z"new Path2D("M9,9 10,10 10,16 9,17 8,16 8,10z"new Path2D("M9,17 8,18 2,18 1,17 2,16 8,16z"new Path2D("M1,17 0,16 0,10 1,9 2,10 2,16z"new Path2D("M1,9 0,8 0,2 1,1 2,2 2,8z"new Path2D("M1,9 2,8 8,8 9,9 8,10 2,10z")chars=[63,6,91,79,102,109,125,7,127,111,73,0,0,0,0,0,0,119,124,88,94,121,113,61,116,4,30,117,56,55,84,92,115,103,80,109,120,28,62,126,118,110,91];drawText=,r,o,n=0,a=1)=>{t.save();s=o/12,l=-n*o*e.length*.5;t.translate(i+l,r-20*s/2);for(i=0;i<e.length;i++){r=chars[e.charCodeAt(i)-48];t.save(t.scale(s,s);o=1;for(e=0;e<7;e++)t.globalAlpha=r&o?a:.1,t.fill(segments[e]o*=2;t.restore(t.translate(12*s,0)}t.restore()};MOUSE_FACTOR=.2,FRAME_TIME=20,STATE_MENU=0,STATE_SHOP=1,STATE_GAME=2,STATE_OPTIONS=3,STATE_HELP=4,shopOps=["ENGINE","SHIELDS","LASER",": BACK"highlightOps=[46,53,6,19,54,61,0,0shopAngles=[3.5,0,-2,0];canvas3D=document.getElementsByTagName`canvas`[0gl=canvas3D.getContext`webgl`,canvas2D=document.getElementsByTagName`canvas`[1c=canvas2D.getContext`2d`,moveR=moveL=moveF=moveB=powerUP=powerDOWN=rollL=rollR=fire=0,lastX=lastY=0,dragging=0,cubeRota=0,lastT=-1,objectId=0,gameState=0,ship={x:0,y:0,z:0,speed:0,rota_quat:[0,0,0,0direc:[0,0,0,0direc:create(shields_power:0,:0,_:0,_t:0,pitch:0,_pitch:0,pitch_t:0,yaw:0,_yaw:0,yaw_t:0,roll:0,_roll:0,roll_t:0};projec=create(camera=create(laser=create(pyr=create();window.addEventListener("keydown",(t=>{39!&&68!||(moveR=137!&&65!||(moveL=138!&&87!||(moveF=140!&&83!||(moveB=181=&&(powerUP=169=&&(powerDOWN=190=&&(rollL=188=&&(rollR=132=&&(fire=1)})window.addEventListener("keyup",(t=>{39!&&68!||(moveR=037!&&65!||(moveL=038!&&87!||(moveF=040!&&83!||(moveB=081=&&(powerUP=069=&&(powerDOWN=090=&&(rollL=088=&&(rollR=032=&&(fire=0)})window.addEventListener("mousedown",(t=>{lastX=t.clientX,lastY=t.clientY,dragging=1})window.addEventListener("mouseup",(t=>{dragging=0})window.addEventListener("mousemove",(t=>{e=.2*(t.clientX-lastXi=.2*(t.clientY-lastY);dragging&&(moveR=e>0?1:0,moveL=e<0?1:0,moveF=i>0?1:0,moveB=i<0?1:0lastX=t.clientX,lastY=t.clientY})getID=t=>objectId++,init3D=t=>{e=45*PI/180,i=canvas3D.width/canvas3D.height;enable(DEPTH_TESTdepthFunc(LEQUALperspective(projec,e,i,.1,1e3)},processInput=t=>{1==moveR&&(yaw_t-=11==moveL&&(yaw_t+=11==moveF&&(pitch_t-=11==moveB&&(pitch_t+=11==powerUP&&(_t+=.151==powerDOWN&&(_t-=.15shields_power>1&&(shields_power=1shields_power<0&&(shields_power=0_t>1&&(_t=1_t<0&&(_t=0rollL&&(roll_t-=1rollR&&(roll_t+=1)},shipLogicTick=t=>{_+=(_t-_)/16,speed+=(_-speed)/16,x+=2*direc[0]*speed,y+=2*direc[1]*speed,z+=2*direc[2]*speed,_pitch+=(pitch_t-_pitch)/16,_yaw+=(yaw_t-_yaw)/16,_roll+=(roll_t-_roll)/16},shipLogicStep=t=>{if(=_+t*(_t-_)/16,roll=_roll+t*(roll_t-_roll)/16,pitch=_pitch+t*(pitch_t-_pitch)/16,yaw=_yaw+t*(yaw_t-_yaw)/16,fromEuler(rota_quat,pitch,yaw,rollfromRotaTransla(direc,rota_quat,[x,y,z]invert(camera,directransformMat4(direc,[0,0,-1,0direcbackground.ship_posi=[x,y,zfire){t=[-cos(roll+PI/2sin(roll+PI/20];e=[];cross(e,direc,t);i=new Laser(getID());i.init(copy(i.rota_quat,rota_quatcopy(i.direc,direci.setPosi([x+.5*e[0]-.5*t[0y+.5*e[1]-.5*t[1z]);r=new Laser(getID());r.init(copy(r.rota_quat,rota_quatcopy(r.direc,direcr.setPosi([x-.5*e[0]-.5*t[0y-.5*e[1]-.5*t[1z]objectList[i.idi,objectList[r.idr}};objectList=[deleteQueue=[renderObj=new Ship(getID());renderObj.init(renderObj.setPosi([0,0,-50]objectList[renderObj.idrenderObj;background=new Background(getID(20,20,500);background.init(objectList[background.idbackground;planet=new Sphere(getID(20,20,40,[1,.5,.2,1!1,[.001,.02,.01]);planet.init(planet.setPosi([-100,-25,-500]objectList[planet.idplanet;planetCloud=new Sphere(getID(20,20,44,[1,1,1,1!0,[.3,.2,.5]);planetCloud.init(planetCloud.setPosi([-100,-25,-500]objectList[planetCloud.idplanetCloud,render=t=>{e=window.innerWidth,i=window.innerHeight;switch(canvas3D.width=e,canvas3D.height=i,canvas2D.width=e,canvas2D.height=i,viewport(0,0,e,iinit3D(processInput(gameState){case 0["PLAY","OPTIONS","HELP"ship,(t=>{dragging=!1,0==t&&(gameState=21==t&&(gameState=1)}));break;case 1shopOps,ship,(t=>{dragging=!1,console.log(t3==t&&(gameState=0)}highlightOps,shopAngles);break;case 2:for(enable(BLENDblendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHAenable(CULL_FACE);t-lastT>=20;){shipLogicTick(t);for(const[e,i]of Object.entries(objectList))i.logicTick(t,ship,objectList);lastT+=20}for(const[t,e]of Object.entries(objectList))e.ttl<=0&&deleteQueue.push(t);deleteQueue.forEach((t=>{delete objectList[t]}));e=(t-lastT)/20;shipLogicStep(e);for(const[t,i]of Object.entries(objectList))i.logicStep(e);clearColor(0,0,0,1clear(COLOR_BUFFER_BIT|DEPTH_BUFFER_BIT);for(const[e,i]of Object.entries(objectList))drawObject(projec,camera,i,t);renderHUD(c,window.innerWidth,window.innerHeight,ship,objectList)}requestAnimaFrame(render)},requestAnimaFrame(render);SEGMENTS=8;renderHUD=,r,o)=>{n="#faac00",a="#2ec0e8",s=e/100;t.save(t.globalAlpha=.8,t.strokeStyle=a,t.beginPath(t.arc(e/2,i/2,e/35,0,2*PIt.moveTo(e/2-1.5*s,i/2-1.5*st.lineTo(e/2-4*s,i/2-4*st.moveTo(e/2+1.5*s,i/2-1.5*st.lineTo(e/2+4*s,i/2-4*st.moveTo(e/2-1.5*s,i/2+1.5*st.lineTo(e/2-4*s,i/2+4*st.moveTo(e/2+1.5*s,i/2+1.5*st.lineTo(e/2+4*s,i/2+4*st.moveTo(e/2,i/2-2*st.lineTo(e/2,i/2-5*st.moveTo(e/2,i/2+2*st.lineTo(e/2,i/2+5*st.moveTo(e/2-2*s,i/2t.lineTo(e/2-5*s,i/2t.moveTo(e/2+2*s,i/2t.lineTo(e/2+5*s,i/2t.stroke(t.lineWidth=2,t.strokeStyle=n;for(r=0;r<4;r++)t.save(t.translate(e/2,i/2t.rotate(PI*r/2t.translate(-e/2,-i/2t.beginPath(t.moveTo(e/2-s/2,i/2-st.lineTo(e/2,i/2-1.5*st.lineTo(e/2+s/2,i/2-st.stroke(t.restore();t.beginPath(t.rect(0,0,e,it.moveTo(e/2+e/30,i/2t.arc(e/2,i/2,e/32,0,2*PIt.clip("evenodd");for(o=0;o<8;o++){s=o*PI/8;t.fillStyle=o/7<r.?n:"#9a4c00",t.beginPath(t.moveTo(e/2,i/2+5t.arc(e/2,i/2+5,e/(25+.4*(8-o)s,s+PI/10t.fill(t.fillStyle=o/7<r.shield_power?a:"#006088",t.beginPath(t.moveTo(e/2,i/2-5t.arc(e/2,i/2-5,e/(25+.4*(8-o)s+PI,s+PI+PI/10t.fill()}t.restore(t.fillStyle="#fff",t.font="20px Terminal",t.fillText("pitch: "+r.pitch/PI,0,20t.fillText("yaw: "+r.yaw/PI,0,40t.fillText(" roll: "+r.roll/PI,0,60t.fillText(" pos: ["+r.x+", "+r.y+", "+r.z+"]",0,80t.fillText(" dir: ["+r.direc[0]+", "+r.direc[1]+", "+r.direc[2]+"]",0,100t.fillText(" objects: ["+Object.entries(o).length+"]",0,120)};~vId=create(bind(ARRAY_BUFFER,$vIdbufferData(ARRAY_BUFFER,$v(	(STATIC_DRAWvAttribPointer($.vColor,4,FLOAT,!1,0,0$^,t[J$shaderProgram=buildShaderProgram($vShader($fragmentShader()$.vPosi=getAttribLoca($shaderProgram,"aVPosi"$.vColor=getAttribLoca($shaderProgram,"aVColo@\\n      $this.tion]=indexId=create(bind(ELEMENT_ARRAY_BUFFER,$indexIdbufferData(ELEMENT_ARRAY_BUFFER,$indMath.r"$us.projec=getU($shaderProgram,"uProjec"$us.modelView=getU($shaderProgram,"uModelView"$us.camera=getU($shaderProgram,"uCamera"$t(t,e){i0r1o2n3a4s5l6h7c8f9g10u11d12p13m14v15x=i*s-r*a,M=i*l-o*a,_=i*h-n*a,A=r*l-o*s,b=r*h-n*s,L=o*h-n*l,R=c*p-f*d,P=c*m-g*d,w=c*v-u*d,T=f*m-g*p,B=f*v-u*p,E=g*v-u*mreturn ship.),ertex0^=e[Buffer],gl.}func Matrixlet niformLoca=t.keyCode	STATIC_DRAWvAttribPointer($.vPosi,3,FLOAT,!1,0,0$colorId=create(bind(ARRAY_BUFFER,$colorIdbufferData(ARRAY_BUFFER,$color;@varying vec4 vPos;\\n@void main(void) {@  vPos = aVPosi;@  gl_Posi = uProjec * uCamera * uModelView * vPos;@  vColor = aVColor;@attribLocas(t,e,iconst engine_power^1:for(;t-lastT>=20;)menuLogicTick(tlastT+=20;menuLogicStep((t-lastT)/20renderMenu(c,window.innerWidth,window.innerHeight,';for(i of'	$@J^~')with(_.split(i))_=join(pop());eval(_)
